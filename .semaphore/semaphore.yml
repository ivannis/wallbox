version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Talk to K8s
    task:
      jobs:
        - name: Get pods
          commands:
            - checkout
            - echo "$KUBERNETES_CLUSTER_CERTIFICATE" | base64 --decode > cert.crt
            - kubectl --kubeconfig=/dev/null --server=$KUBERNETES_SERVER --certificate-authority=cert.crt --token=$KUBERNETES_TOKEN get pods
      secrets:
        - name: do-k8s
      env_vars: []
